<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>果壳宇宙 | Leo's Blog</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- 引入 Feather Icons 图标库 -->
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>

    <header class="header">
        <div class="logo"><a href="index.html">Leo's Blog</a></div>
        <nav class="nav">
            <a href="index.html" class="active">主页</a>
            <a href="#">归档</a>
            <a href="#">关于</a>
            <a href="editor.html" class="nav-btn">写文章</a>
        </nav>
    </header>

    <div class="hero">
        <h1>Hey.</h1>
        <p>玫瑰与星辰是我果壳里的宇宙。</p>
    </div>

    <div class="container">
        <!-- 主内容区 -->
        <main class="main-content" id="articlesContainer">
            <!-- 文章将通过 JS 插入这里 -->
            <div style="text-align: center; color: var(--text-secondary); margin-top: 50px;">
                正在连接宇宙信号...
            </div>
        </main>

        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-widget">
                <h3><i data-feather="user"></i> 关于作者</h3>
                <p style="color: var(--text-secondary); font-size: 0.95rem;">
                    一位曾经信奉玫瑰与星辰的凡人，现在仍然信奉着。
                </p>
            </div>

            <div class="sidebar-widget">
                <h3><i data-feather="tag"></i> 标签云</h3>
                <div class="tags-cloud" id="tagsContainer">
                    <!-- 标签将自动生成 -->
                </div>
            </div>
        </aside>
    </div>

    <script>
        // 初始化图标
        feather.replace();

        let allArticles = [];

        // 1. 获取文章数据
        async function fetchArticles() {
            try {
                // 优先读取 articles.json (适配 GitHub Pages)
                const response = await fetch('articles.json');
                if (!response.ok) throw new Error('无法加载文章列表');
                
                allArticles = await response.json();
                
                // 按日期倒序排列【这里是卡片排序规则！】
                allArticles.sort((a, b) => new Date(b.date) - new Date(a.date));

                renderTags();
                renderArticles(allArticles);
            } catch (error) {
                console.error(error);
                document.getElementById('articlesContainer').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>⚠️ 加载失败</h3>
                        <p>请确保根目录下存在 <code>articles.json</code> 且格式正确。</p>
                    </div>
                `;
            }
        }

        // 2. 渲染标签云
        function renderTags() {
            const tagsMap = new Map();
            
            // 统计标签数量
            allArticles.forEach(article => {
                if (article.tags) {
                    article.tags.forEach(tag => {
                        tagsMap.set(tag, (tagsMap.get(tag) || 0) + 1);
                    });
                }
            });

            const tagsContainer = document.getElementById('tagsContainer');
            tagsContainer.innerHTML = `<span class="tag-item active" onclick="filterArticles('all', this)">全部</span>`;

            tagsMap.forEach((count, tag) => {
                tagsContainer.innerHTML += `
                    <span class="tag-item" onclick="filterArticles('${tag}', this)">
                        #${tag} <span style="opacity:0.6; font-size:0.8em;">${count}</span>
                    </span>
                `;
            });
        }

        // 3. 渲染文章列表
        function renderArticles(articles) {
            const container = document.getElementById('articlesContainer');
            container.innerHTML = '';
            
            // 添加入场动画类
            container.style.opacity = '0';
            container.style.transform = 'translateY(10px)';
            
            if (articles.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:40px; color:#999;">没有找到相关文章...</div>';
            } else {
                articles.forEach(article => {
                    // 生成标签 HTML
                    const tagsHtml = article.tags.map(tag => `<span class="meta-tag">${tag}</span>`).join('');
                    
                    const card = `
                        <article class="article-card">
                            <div class="article-meta">
                                <span>${article.date}</span>
                                ${tagsHtml}
                            </div>
                            <h2><a href="article.html?id=${article.id}&file=${article.file}">${article.title}</a></h2>
                            <p class="article-excerpt">${article.excerpt}</p>
                        </article>
                    `;
                    container.innerHTML += card;
                });
            }

            // 简单的淡入动画
            setTimeout(() => {
                container.style.transition = 'all 0.5s ease';
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 50);
        }

        // 4. 筛选功能
        window.filterArticles = function(tag, element) {
            // 更新按钮状态
            document.querySelectorAll('.tag-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');

            if (tag === 'all') {
                renderArticles(allArticles);
            } else {
                const filtered = allArticles.filter(a => a.tags && a.tags.includes(tag));
                renderArticles(filtered);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchArticles);
    </script>
</body>
</html>