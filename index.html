<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœå£³å®‡å®™</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="header">
        <div class="logo"><a href="index.html">Leo's Blog</a></div>
        <nav class="nav">
            <a href="index.html">ä¸»é¡µ</a>
            <a href="#">å½’æ¡£</a>
            <a href="#">å…³äºæˆ‘</a>
            <a href="#">è”ç³»</a>
            <a href="editor.html" class="btn btn-primary" style="padding: 6px 15px; border-radius: 4px;">å†™æ–‡ç« </a>
        </nav>
    </div>

    <div class="hero">
        <h1>Welcome to My Brain Garden.</h1>
        <p>è¿™å°±æ˜¯æˆ‘æœå£³é‡Œçš„å®‡å®™ã€‚</p>
    </div>

    <div class="container">
        <div class="main-content" id="articlesContainer">
            <div style="text-align: center; padding: 50px;">åŠ è½½æ–‡ç« ä¸­...</div>
        </div>

        <div class="sidebar">
            <h3>ğŸ‘¤ å…³äºä½œè€…</h3>
            <p>ä¸€ä½æ›¾ç»ä¿¡å¥‰ç«ç‘°ä¸æ˜Ÿè¾°çš„å‡¡äººï¼Œç°åœ¨ä»ç„¶ä¿¡å¥‰ç€ã€‚åœ¨è¿™é‡Œï¼Œä»–å¸Œæœ›èƒ½åšæŒçƒ­çˆ±ä¸‹å»ã€‚</p>
            <br>
            <h3>ğŸ·ï¸ çƒ­é—¨æ ‡ç­¾</h3>
            <p>
                <a style="margin-right: 8px;" href="#">#å‰ç«¯æŠ€æœ¯ </a>
                <a style="margin-right: 8px;" href="#">#é˜…è¯»</a>
                <a style="margin-right: 8px;" href="#">#ç¤¾ç§‘</a>
                <a style="margin-right: 8px;" href="#">#å“²æ€</a>
            </p>
        </div>
    </div>

    <script>
        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸï¼ˆYYYY-MM-DD â†’ YYYYå¹´MMæœˆDDæ—¥ï¼‰
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return formatTodayDate();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}å¹´${month}æœˆ${day}æ—¥`;
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–ä»Šæ—¥æ—¥æœŸï¼ˆYYYYå¹´MMæœˆDDæ—¥ï¼‰
        function formatTodayDate() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}å¹´${month}æœˆ${day}æ—¥`;
        }

        // å·¥å…·å‡½æ•°ï¼šæ¸…ç†Markdownæ ¼å¼
        function cleanMarkdown(content) {
            let cleaned = content.replace(/<!--\s*createTime:\s*\d{4}-\d{2}-\d{2}\s*-->/g, '');
            cleaned = cleaned
                .replace(/#+\s+/g, '')
                .replace(/>+\s*/g, '')
                .replace(/\*+|\**/g, '')
                .replace(/`+.*?`+/g, '')
                .replace(/!\[.*?\]\(.*?\)/g, '')
                .replace(/\[.*?\]\(.*?\)/g, '')
                .replace(/-{3,}|={3,}/g, '')
                .replace(/\s+/g, ' ')
                .trim();
            return cleaned;
        }

        async function fetchArticleFiles() {
            try {
                // æ”¹ä¸ºè¯·æ±‚æ‰‹åŠ¨ç»´æŠ¤çš„æ–‡ç« æ¸…å•æ–‡ä»¶
                const response = await fetch('Article/articles.json');
                if (!response.ok) throw new Error(`è·å–æ¸…å•å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`);

                // ç›´æ¥è§£æ JSON å¾—åˆ°æ–‡ä»¶ååˆ—è¡¨
                const fileNames = await response.json();
                
                // è¿‡æ»¤é .md æ–‡ä»¶ï¼ˆåŒé‡ä¿é™©ï¼‰
                const validFiles = fileNames.filter(name => 
                    name.endsWith('.md') && name.trim() !== ''
                );

                console.log('ä» articles.json è§£æåˆ°çš„.mdæ–‡ä»¶ï¼š', validFiles);

                if (validFiles.length === 0) {
                    document.getElementById('articlesContainer').innerHTML = '<div style="text-align: center; padding: 50px;">Articleç›®å½•ä¸‹æš‚æ— .mdæ–‡ç« </div>';
                    return [];
                }

                return validFiles;
            } catch (error) {
                console.error('è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);
                const fallbackFiles = ['1.md', '2.md', '3.md', '4.md'];
                document.getElementById('articlesContainer').innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #ff4444;">
                        æ–‡ç« æ¸…å•åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ articles.json æ˜¯å¦å­˜åœ¨<br>
                        å…œåº•åŠ è½½é»˜è®¤æ–‡ç« ï¼ˆ${fallbackFiles.length}ç¯‡ï¼‰
                    </div>
                `;
                return fallbackFiles;
            }
        }
        // ç”Ÿæˆæ–‡ç« å¡ç‰‡
        function createArticleCards(fileNames) {
            const container = document.getElementById('articlesContainer');
            container.innerHTML = '';

            fileNames.forEach((fileName, index) => {
                const card = document.createElement('div');
                card.className = 'article-card fade-in';
                card.dataset.file = fileName;
                card.style.transitionDelay = `${index * 0.1}s`;

                // å¡ç‰‡é“¾æ¥ä¿®å¤ï¼šç¡®ä¿hrefæ˜¯æ­£ç¡®çš„ç›¸å¯¹è·¯å¾„
                card.innerHTML = `
                    <h2 class="article-title"><a href="article.html?file=${encodeURIComponent(fileName)}">åŠ è½½ä¸­...</a></h2>
                    <div class="meta">åŠ è½½ä¸­...</div>
                    <p class="excerpt">åŠ è½½ä¸­...</p>
                `;

                container.appendChild(card);
            });

            return document.querySelectorAll('.article-card');
        }

        // åŠ è½½æ‰€æœ‰æ–‡ç« ä¿¡æ¯
        async function loadAllArticleInfo() {
            const fileNames = await fetchArticleFiles();
            if (fileNames.length === 0) return;

            const cards = createArticleCards(fileNames);

            for (const card of cards) {
                const fileName = card.dataset.file;
                const titleElement = card.querySelector('.article-title a');
                const metaElement = card.querySelector('.meta');
                const excerptElement = card.querySelector('.excerpt');
                
                try {
                    // å…³é”®ï¼šè¯·æ±‚è·¯å¾„ç¡®ä¿æ˜¯ "Article/æ–‡ä»¶å"ï¼ˆçº¯ç›¸å¯¹è·¯å¾„ï¼‰
                    const requestUrl = `Article/${encodeURIComponent(fileName)}`;
                    console.log('è¯·æ±‚æ–‡ç« æ–‡ä»¶ï¼š', requestUrl); // æ‰“å°è¯·æ±‚è·¯å¾„ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
                    
                    const response = await fetch(requestUrl);
                    if (!response.ok) throw new Error(`çŠ¶æ€ç : ${response.status}`);
                    
                    const content = await response.text();
                    const plainText = cleanMarkdown(content);

                    // æå–åˆ›å»ºæ—¶é—´
                    const createTimeRegex = /<!--\s*createTime:\s*(\d{4}-\d{2}-\d{2})\s*-->/;
                    const createTimeMatch = content.match(createTimeRegex);
                    const publishDate = createTimeMatch 
                        ? formatDate(createTimeMatch[1]) 
                        : formatTodayDate();

                    // æå–æ ‡é¢˜å’Œæ‘˜è¦
                    const title = plainText.length > 15 
                        ? plainText.substring(0, 15) + '...' 
                        : plainText;
                    const excerpt = plainText.length > 100 
                        ? plainText.substring(0, 100) + '...' 
                        : plainText;

                    // æ›´æ–°DOM
                    metaElement.textContent = publishDate;
                    titleElement.textContent = title;
                    excerptElement.textContent = excerpt;

                } catch (error) {
                    console.error(`åŠ è½½ ${fileName} å¤±è´¥:`, error);
                    titleElement.textContent = `æ–‡ç« åŠ è½½å¤±è´¥`;
                    metaElement.textContent = formatTodayDate();
                    excerptElement.textContent = `åŠ è½½å¤±è´¥ï¼ˆ${error.message}ï¼‰`;
                }
            }

            initFadeInAnimation();
        }

        // æ»šåŠ¨æ¸æ˜¾åŠ¨ç”»
        function initFadeInAnimation() {
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            const cards = document.querySelectorAll('.article-card.fade-in');
            cards.forEach(card => observer.observe(card));
        }

        // é¡µé¢åŠ è½½åæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', loadAllArticleInfo);
    </script>
</body>
</html>